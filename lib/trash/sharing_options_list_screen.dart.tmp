import 'package:flutter/material.dart';
import 'package:wavsound/constants/colors.dart';
import 'package:wavsound/constants/share_page_list.dart';

class ShareListingScreen extends StatefulWidget {
  final String? text;
  ShareListingScreen({this.text = ""});
  @override
  _ShareListingScreenState createState() => _ShareListingScreenState();
}

class _ShareListingScreenState extends State<ShareListingScreen> {
  List<SharePageDetails> pages = [
    SharePageDetails(pageTitle: "Import Sounds", isSelected: false),
    SharePageDetails(pageTitle: "Stream Sounds", isSelected: false),
    SharePageDetails(pageTitle: "Extract Sounds from Video", isSelected: false),
  ];
  bool _isSelected = false;
  List<String?> _selectedNames = [];

  @override
  Widget build(BuildContext context) {
    return Column(
      children: [_userListingView(context), _selectedUserListingView(context)],
    );
  }

  Widget _userListingView(BuildContext context) => Expanded(
      child: ListView.builder(
          itemCount: pages.length,
          itemBuilder: (context, index) {
            return _userListItemView(context, index);
          }));

  Widget _userListItemView(BuildContext context, int index) => Card(
        elevation: 3,
        child: ListTile(
          selected: pages[index].isSelected,
          selectedTileColor: AppColors.blueColor,
          dense: true,
          onTap: () {
            _onListTileTap(index);
          },
          leading: _leadingCircularView(index),
          title: _titleView(index),
        ),
      );

  Widget _leadingCircularView(int index) => CircleAvatar(
      backgroundColor: pages[index].isSelected
          ? AppColors.secondaryColor
          : AppColors.dimTextColor,
      child: Text(
        pages[index].pageTitle.substring(0, 1),
        style: TextStyle(
            color: pages[index].isSelected
                ? AppColors.blueColor
                : AppColors.primaryColor),
      ));

  Widget _titleView(int index) => Text(pages[index].pageTitle,
      style: TextStyle(
          color: pages[index].isSelected
              ? AppColors.blueColor
              : AppColors.primaryColor));

  Widget _selectedUserListingView(BuildContext context) => (_selectedNames
          .isNotEmpty)
      ? Container(
          height: 50,
          decoration: BoxDecoration(color: AppColors.primaryColor, boxShadow: [
            BoxShadow(offset: Offset(0, -3), blurRadius: 5, color: Colors.grey)
          ]),
          padding: EdgeInsets.symmetric(horizontal: 10),
          child: ListView.builder(
              itemCount: _selectedNames.length,
              scrollDirection: Axis.horizontal,
              itemBuilder: (context, index) {
                return Center(
                    child: Text(
                        "${"${_selectedNames[index]}"}${index == _selectedNames.length - 1 ? "" : " , "}",
                        style: TextStyle(
                            fontSize: 14, fontWeight: FontWeight.w500)));
              }))
      : SizedBox();

  void _onListTileTap(int index) {
    setState(() {
      pages[index].isSelected = !pages[index].isSelected;
      for (var names in pages) {
        if (names.isSelected) {
          if (!_selectedNames.contains(names.pageTitle)) {
            _selectedNames.add(names.pageTitle);
          }
        } else {
          _selectedNames.remove(names.pageTitle);
        }
      }
      _isSelected = _selectedNames.isNotEmpty;
    });
  }
}
